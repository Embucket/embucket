suites:
  # Individual dataset test suites - replaces predefined queries from datasets.yaml
  - name: tpch_lineitem_dataset
    relations:
      table: tpch_lineitem
    queries:
      - id: q_count
        sql: |
          SELECT COUNT(*) FROM {{TABLE:table}}
      - id: q_return_linestatus
        sql: |
          SELECT "L_RETURNFLAG", "L_LINESTATUS", SUM("L_QUANTITY") AS qty, SUM("L_EXTENDEDPRICE") AS rev, COUNT(*) AS c
          FROM {{TABLE:table}}
          GROUP BY "L_RETURNFLAG", "L_LINESTATUS"
      - id: q_shipmode
        sql: |
          SELECT "L_SHIPMODE", COUNT(*) AS c
          FROM {{TABLE:table}}
          GROUP BY "L_SHIPMODE"
      - id: q_year_1994
        sql: |
          SELECT COUNT(*) AS c
          FROM {{TABLE:table}}
          WHERE L_SHIPDATE >= CAST('1994-01-01' AS DATE) AND L_SHIPDATE < CAST('1995-01-01' AS DATE)
      - id: q_discounted_revenue
        sql: |
          SELECT SUM(L_EXTENDEDPRICE * (1 - L_DISCOUNT)) AS discounted_rev FROM {{TABLE:table}}

  - name: nyc_taxi_dataset
    relations:
      table: nyc_taxi_yellow
    queries:
      - id: q_count
        sql: |
          SELECT COUNT(*) FROM {{TABLE:table}}
      - id: q_vendor_counts
        sql: |
          SELECT vendor_id, COUNT(*) AS c FROM {{TABLE:table}} GROUP BY vendor_id
      - id: q_payment_amounts
        sql: |
          SELECT payment_type, COUNT(*) AS c, SUM(total_amount) AS total
          FROM {{TABLE:table}}
          GROUP BY payment_type
      - id: q_daily_counts
        sql: |
          SELECT CAST(tpep_pickup_datetime AS DATE) AS d, COUNT(*) AS c
          FROM {{TABLE:table}}
          GROUP BY CAST(tpep_pickup_datetime AS DATE)
      - id: q_vendor_avg_distance
        sql: |
          SELECT vendor_id, AVG(trip_distance) AS avg_dist
          FROM {{TABLE:table}}
          GROUP BY vendor_id

  # Comprehensive test suites with additional aggregations
  - name: nyc_comprehensive
    relations:
      trips: nyc_taxi_yellow
    queries:
      - id: q_count
        sql: |
          SELECT COUNT(*) FROM {{TABLE:trips}}
      - id: q_vendor_counts
        sql: |
          SELECT vendor_id, COUNT(*) AS c FROM {{TABLE:trips}} GROUP BY vendor_id ORDER BY vendor_id
      - id: q_payment_amounts
        sql: |
          SELECT payment_type, COUNT(*) AS c, SUM(total_amount) AS total
          FROM {{TABLE:trips}}
          GROUP BY payment_type ORDER BY payment_type
      - id: q_basic_agg
        sql: |
          SELECT COUNT(*) AS count_all, COUNT(DISTINCT vendor_id) AS count_distinct, SUM(total_amount) AS sum_numeric
          FROM {{TABLE:trips}}
      - id: q_daily_counts
        sql: |
          SELECT CAST(tpep_pickup_datetime AS DATE) AS d, COUNT(*) AS c
          FROM {{TABLE:trips}}
          GROUP BY CAST(tpep_pickup_datetime AS DATE)
          ORDER BY d
      - id: q_vendor_avg_distance
        sql: |
          SELECT vendor_id, AVG(trip_distance) AS avg_dist
          FROM {{TABLE:trips}}
          GROUP BY vendor_id
          ORDER BY vendor_id

  - name: tpch_lineitem_comprehensive
    relations:
      l: tpch_lineitem
    queries:
      - id: q_count
        sql: |
          SELECT COUNT(*) FROM {{TABLE:l}}
      - id: q_basic_agg
        sql: |
          SELECT COUNT(*) AS count_all, COUNT(DISTINCT L_ORDERKEY) AS count_distinct, SUM(L_QUANTITY) AS sum_numeric
          FROM {{TABLE:l}}
      - id: q_return_linestatus
        sql: |
          SELECT "L_RETURNFLAG", "L_LINESTATUS", SUM("L_QUANTITY") AS qty, SUM("L_EXTENDEDPRICE") AS rev, COUNT(*) AS c
          FROM {{TABLE:l}}
          GROUP BY "L_RETURNFLAG", "L_LINESTATUS"
          ORDER BY "L_RETURNFLAG", "L_LINESTATUS"
      - id: q_shipmode
        sql: |
          SELECT "L_SHIPMODE", COUNT(*) AS c
          FROM {{TABLE:l}}
          GROUP BY "L_SHIPMODE"
          ORDER BY "L_SHIPMODE"
      - id: q_year_1994
        sql: |
          SELECT COUNT(*) AS c
          FROM {{TABLE:l}}
          WHERE L_SHIPDATE >= CAST('1994-01-01' AS DATE) AND L_SHIPDATE < CAST('1995-01-01' AS DATE)
      - id: q_discounted_revenue
        sql: |
          SELECT SUM(L_EXTENDEDPRICE * (1 - L_DISCOUNT)) AS discounted_rev FROM {{TABLE:l}}

  # Legacy suites for backward compatibility
  - name: nyc_basic
    relations:
      trips: nyc_taxi_yellow
    queries:
      - id: q_count
        sql: |
          SELECT COUNT(*) FROM {{TABLE:trips}}
      - id: q_vendor
        sql: |
          SELECT vendor_id, COUNT(*) AS c FROM {{TABLE:trips}} GROUP BY vendor_id
      - id: q_payment_amounts
        sql: |
          SELECT payment_type, COUNT(*) AS c, SUM(total_amount) AS total
          FROM {{TABLE:trips}}
          GROUP BY payment_type

  - name: tpch_lineitem_basic
    relations:
      l: tpch_lineitem
    queries:
      - id: q_count
        sql: |
          SELECT COUNT(*) FROM {{TABLE:l}}
      - id: q_group
        sql: |
          SELECT L_RETURNFLAG, L_LINESTATUS, SUM(L_QUANTITY) AS qty
          FROM {{TABLE:l}}
          GROUP BY L_RETURNFLAG, L_LINESTATUS

  # Example of a cross-table suite (requires you to define more datasets in datasets.yaml)
  # - name: tpch_cross_example
  #   relations:
  #     l: tpch_lineitem
  #     o: tpch_orders           # Define a matching dataset in datasets.yaml
  #     c: tpch_customer         # Define a matching dataset in datasets.yaml
  #   queries:
  #     - id: q_orders_by_year
  #       sql: |
  #         SELECT YEAR(o.O_ORDERDATE) AS y, COUNT(*) AS c
  #         FROM {{TABLE:o}} o
  #         JOIN {{TABLE:l}} l ON l.L_ORDERKEY = o.O_ORDERKEY
  #         GROUP BY YEAR(o.O_ORDERDATE)

