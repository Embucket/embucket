import{aj as g,ai as b,ak as y,j as e,e as S,B as l,t as C,f as F,r as q,n as D}from"./index-CjoQ4fRC.js";import{S as d,a as h,E as v}from"./scroll-area-DCtIo-yg.js";import{R as N,a as x,b as K}from"./trees-items-N2jdKUkU.js";import{A as T,a as z}from"./alert-Bq1YwiTQ.js";import{D as P,a as O,b as Q,c as H,d as A,g as G}from"./dialog-D45-WVeI.js";import{g as R,F as $}from"./navigation-trees-Avl3C5aF.js";import{u as w,s as M,z as p,F as k,a as E,b as Y,c as B,d as I,e as V}from"./form-D6L8E6Qw.js";import{b as L}from"./input-DRnyAiMX.js";import{D as J,a as _}from"./databases-page-trees-C_DaTS2y.js";import{c as U,D as W}from"./data-table-Ba_YU8nU.js";import{d as m}from"./dayjs-3QZw4l_g.js";const X=(a,s,r,t)=>y({url:`/ui/databases/${a}/schemas`,method:"GET",params:s,signal:t},r),f=(a,s)=>[`/ui/databases/${a}/schemas`],Z=(a,s,r)=>{const{query:t,request:n}={};return{queryKey:(t==null?void 0:t.queryKey)??f(a),queryFn:({signal:c})=>X(a,s,n,c),enabled:!!a,...t}};function ee(a,s,r,t){const n=Z(a,s),o=g(n);return o.queryKey=n.queryKey,o}const ae=(a,s,r,t)=>y({url:`/ui/databases/${a}/schemas`,method:"POST",headers:{"Content-Type":"application/json"},data:s,signal:t},r),te=a=>{const s=["createSchema"],{mutation:r,request:t}=a?a.mutation&&"mutationKey"in a.mutation&&a.mutation.mutationKey?a:{...a,mutation:{...a.mutation,mutationKey:s}}:{mutation:{mutationKey:s},request:void 0};return{mutationFn:o=>{const{databaseName:i,data:c}=o??{};return ae(i,c,t)},...r}},se=(a,s)=>{const r=te(a);return b(r)},re=p.object({name:p.string()}),ne=({onSubmit:a})=>{const s=w({resolver:M(re),defaultValues:{name:""}});return e.jsx(k,{...s,children:e.jsx("form",{id:"createSchemaDialogForm",onSubmit:s.handleSubmit(a),className:"flex flex-col gap-2",children:e.jsx(E,{control:s.control,name:"name",render:({field:r})=>e.jsxs(Y,{children:[e.jsx(B,{children:"Schema Name"}),e.jsx(I,{children:e.jsx(L,{...r,type:"name",required:!0})}),e.jsx(V,{})]})})})})};function oe({opened:a,onSetOpened:s,databaseName:r}){var c;const t=S(),{mutate:n,isPending:o,error:i}=se({mutation:{onSuccess:async()=>{await Promise.all([t.invalidateQueries({queryKey:R()}),t.invalidateQueries({queryKey:G()}),t.invalidateQueries({queryKey:f(r)})]),s(!1),C.success("Schema was successfully created")}}});return e.jsx(P,{open:a,onOpenChange:s,children:e.jsxs(O,{children:[e.jsx(Q,{children:e.jsx(H,{children:"Create Schema"})}),i&&e.jsx(T,{variant:"destructive",children:e.jsx(z,{children:JSON.stringify((c=i.response)==null?void 0:c.data)})}),e.jsx(ne,{onSubmit:u=>{n({databaseName:r,data:{name:u.name}})}}),e.jsxs(A,{children:[e.jsx(l,{disabled:o,variant:"outline",onClick:()=>s(!1),children:"Cancel"}),e.jsx(l,{disabled:o,form:"createSchemaDialogForm",type:"submit",children:"Create"})]})]})})}function ie({isLoading:a,schemas:s}){const r=F(),t=U(),n=[t.accessor("name",{header:"Name"}),t.accessor("created_at",{header:"Start Time",cell:i=>{const c=m(i.getValue()),j=m().diff(c,"minute")<24?m(c).fromNow():m(c).format("DD/MM/YYYY HH:mm");return e.jsx("span",{children:j})}})],o=i=>{r({to:"/databases/$databaseName/schemas/$schemaName/tables",params:{databaseName:i.database,schemaName:i.name}})};return e.jsx(W,{rounded:!0,columns:n,data:s,isLoading:a,onRowClick:o})}function ce(){const[a,s]=q.useState(!1),{databaseName:r}=D({from:"/databases/$databaseName/schemas/"}),{data:{items:t}={},isFetching:n}=ee(r);return e.jsxs(e.Fragment,{children:[e.jsxs(N,{direction:"horizontal",children:[e.jsx(x,{collapsible:!0,defaultSize:20,minSize:20,order:1,children:e.jsx(J,{})}),e.jsx(K,{withHandle:!0}),e.jsxs(x,{collapsible:!0,defaultSize:20,order:1,children:[e.jsx(_,{title:"Database schemas",secondaryText:`${t==null?void 0:t.length} schemas found`,Action:e.jsx(l,{onClick:()=>s(!0),children:"Add Schema"})}),t!=null&&t.length?e.jsxs(d,{className:"h-[calc(100vh-117px-32px-2px)]",children:[e.jsx("div",{className:"flex size-full flex-col p-4",children:e.jsxs(d,{tableViewport:!0,children:[e.jsx(ie,{schemas:t,isLoading:n}),e.jsx(h,{orientation:"horizontal"})]})}),e.jsx(h,{orientation:"vertical"})]}):e.jsx(v,{className:"h-[calc(100vh-117px-32px-2px)]",Icon:$,title:"No Schemas Found",description:"No schemas have been created yet. Create a schema to get started."})]})]}),e.jsx(oe,{opened:a,onSetOpened:s,databaseName:r})]})}const be=ce;export{be as component};
