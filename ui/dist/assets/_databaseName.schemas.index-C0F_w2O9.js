import{aj as f,ai as g,ak as y,j as e,e as j,B as u,t as b,f as S,r as C,n as D,D as F}from"./index-DjT3CWpx.js";import{R as q,a as d,b as K}from"./trees-items-Daq-qgQK.js";import{A as T,a as v}from"./alert-ueT3aX-t.js";import{D as N,a as P,b as O,c as Q,d as z,g as H}from"./dialog-DB_pXBY7.js";import{g as G,F as R}from"./navigation-trees-CDOB_4I2.js";import{u as $,s as A,z as h,F as M,a as k,b as w,c as E,d as I,e as Y}from"./form-DJ15pkL6.js";import{b as B}from"./input-CWTrCadC.js";import{D as L,a as V,b as J}from"./data-page-trees-C2XBjh5V.js";import{c as _,D as U}from"./data-table-_i2F3GhZ.js";import{d as m}from"./dayjs--ECgqgNU.js";const W=(a,s,r,t)=>y({url:`/ui/databases/${a}/schemas`,method:"GET",params:s,signal:t},r),p=(a,s)=>[`/ui/databases/${a}/schemas`],X=(a,s,r)=>{const{query:t,request:n}={};return{queryKey:(t==null?void 0:t.queryKey)??p(a),queryFn:({signal:c})=>W(a,s,n,c),enabled:!!a,...t}};function Z(a,s,r,t){const n=X(a,s),o=f(n);return o.queryKey=n.queryKey,o}const ee=(a,s,r,t)=>y({url:`/ui/databases/${a}/schemas`,method:"POST",headers:{"Content-Type":"application/json"},data:s,signal:t},r),ae=a=>{const s=["createSchema"],{mutation:r,request:t}=a?a.mutation&&"mutationKey"in a.mutation&&a.mutation.mutationKey?a:{...a,mutation:{...a.mutation,mutationKey:s}}:{mutation:{mutationKey:s},request:void 0};return{mutationFn:o=>{const{databaseName:i,data:c}=o??{};return ee(i,c,t)},...r}},te=(a,s)=>{const r=ae(a);return g(r)},se=h.object({name:h.string()}),re=({onSubmit:a})=>{const s=$({resolver:A(se),defaultValues:{name:""}});return e.jsx(M,{...s,children:e.jsx("form",{id:"createSchemaDialogForm",onSubmit:s.handleSubmit(a),className:"flex flex-col gap-2",children:e.jsx(k,{control:s.control,name:"name",render:({field:r})=>e.jsxs(w,{children:[e.jsx(E,{children:"Schema Name"}),e.jsx(I,{children:e.jsx(B,{...r,type:"name",required:!0})}),e.jsx(Y,{})]})})})})};function ne({opened:a,onSetOpened:s,databaseName:r}){var c;const t=j(),{mutate:n,isPending:o,error:i}=te({mutation:{onSuccess:async()=>{await Promise.all([t.invalidateQueries({queryKey:G()}),t.invalidateQueries({queryKey:H()}),t.invalidateQueries({queryKey:p(r)})]),s(!1),b.success("Schema was successfully created")}}});return e.jsx(N,{open:a,onOpenChange:s,children:e.jsxs(P,{children:[e.jsx(O,{children:e.jsx(Q,{children:"Create Schema"})}),i&&e.jsx(T,{variant:"destructive",children:e.jsx(v,{children:JSON.stringify((c=i.response)==null?void 0:c.data)})}),e.jsx(re,{onSubmit:l=>{n({databaseName:r,data:{name:l.name}})}}),e.jsxs(z,{children:[e.jsx(u,{disabled:o,variant:"outline",onClick:()=>s(!1),children:"Cancel"}),e.jsx(u,{disabled:o,form:"createSchemaDialogForm",type:"submit",children:"Create"})]})]})})}function oe({isLoading:a,schemas:s}){const r=S(),t=_(),n=[t.accessor("name",{header:"Name"}),t.accessor("created_at",{header:"Start Time",cell:i=>{const c=m(i.getValue()),x=m().diff(c,"minute")<24?m(c).fromNow():m(c).format("DD/MM/YYYY HH:mm");return e.jsx("span",{children:x})}})],o=i=>{r({to:"/databases/$databaseName/schemas/$schemaName/tables",params:{databaseName:i.database,schemaName:i.name}})};return e.jsx(U,{rounded:!0,columns:n,data:s,isLoading:a,onRowClick:o})}function ie(){const[a,s]=C.useState(!1),{databaseName:r}=D({from:"/databases/$databaseName/schemas/"}),{data:{items:t}={},isFetching:n}=Z(r);return e.jsxs(e.Fragment,{children:[e.jsxs(q,{direction:"horizontal",children:[e.jsx(d,{collapsible:!0,defaultSize:20,minSize:20,order:1,children:e.jsx(L,{})}),e.jsx(K,{withHandle:!0}),e.jsxs(d,{collapsible:!0,defaultSize:20,order:1,children:[e.jsx(V,{title:r,Icon:F,secondaryText:`${t==null?void 0:t.length} schemas found`,Action:e.jsx(u,{disabled:n,onClick:()=>s(!0),children:"Add Schema"})}),e.jsx(J,{isEmpty:!(t!=null&&t.length),Table:e.jsx(oe,{isLoading:n,schemas:t??[]}),emptyStateIcon:R,emptyStateTitle:"No Schemas Found",emptyStateDescription:"No schemas have been created yet. Create a schema to get started."})]})]}),e.jsx(ne,{opened:a,onSetOpened:s,databaseName:r})]})}const ge=ie;export{ge as component};
