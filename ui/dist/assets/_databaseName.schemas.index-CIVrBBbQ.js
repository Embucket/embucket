import{af as g,ah as x,ag as y,j as e,f as j,B as u,a0 as b,g as S,r as D,o as C,D as F}from"./index-DjWaHfFL.js";import{R as q,a as d,b as K}from"./trees-items-DUrPA1mG.js";import{u as T,s as v,z as h,F as N,b as P,c as O,d as Q,e as z,f as H,A as G,a as R}from"./form-ZUtrbLJC.js";import{D as $,b as A,c as M,d as w,e as k,g as E}from"./index-DMtN3C__.js";import{g as I,F as Y}from"./create-database-dialog-DUYnPK5O.js";import{b as B}from"./input-8BMw7f6t.js";import{D as L,a as V}from"./data-page-header-DrDxf30N.js";import{D as J}from"./data-page-trees-DlUBG_9i.js";import{c as _,D as U}from"./data-table-CGEkQJDF.js";import{d as m}from"./dayjs-pJhRe8dr.js";import"./create-volume-dialog-BSURLnN1.js";const W=(a,s,r,t)=>y({url:`/ui/databases/${a}/schemas`,method:"GET",params:s,signal:t},r),p=(a,s)=>[`/ui/databases/${a}/schemas`],X=(a,s,r)=>{const{query:t,request:n}={};return{queryKey:(t==null?void 0:t.queryKey)??p(a),queryFn:({signal:c})=>W(a,s,n,c),enabled:!!a,...t}};function Z(a,s,r,t){const n=X(a,s),o=g(n);return o.queryKey=n.queryKey,o}const ee=(a,s,r,t)=>y({url:`/ui/databases/${a}/schemas`,method:"POST",headers:{"Content-Type":"application/json"},data:s,signal:t},r),ae=a=>{const s=["createSchema"],{mutation:r,request:t}=a?a.mutation&&"mutationKey"in a.mutation&&a.mutation.mutationKey?a:{...a,mutation:{...a.mutation,mutationKey:s}}:{mutation:{mutationKey:s},request:void 0};return{mutationFn:o=>{const{databaseName:i,data:c}=o??{};return ee(i,c,t)},...r}},te=(a,s)=>{const r=ae(a);return x(r)},se=h.object({name:h.string()}),re=({onSubmit:a})=>{const s=T({resolver:v(se),defaultValues:{name:""}});return e.jsx(N,{...s,children:e.jsx("form",{id:"createSchemaDialogForm",onSubmit:s.handleSubmit(a),className:"flex flex-col gap-4",children:e.jsx(P,{control:s.control,name:"name",render:({field:r})=>e.jsxs(O,{children:[e.jsx(Q,{children:"Schema Name"}),e.jsx(z,{children:e.jsx(B,{...r,type:"name",required:!0})}),e.jsx(H,{})]})})})})};function ne({opened:a,onSetOpened:s,databaseName:r}){var c;const t=j(),{mutate:n,isPending:o,error:i}=te({mutation:{onSuccess:async()=>{await Promise.all([t.invalidateQueries({queryKey:I()}),t.invalidateQueries({queryKey:E()}),t.invalidateQueries({queryKey:p(r)})]),s(!1),b.success("Schema was successfully created")}}});return e.jsx($,{open:a,onOpenChange:s,children:e.jsxs(A,{children:[e.jsx(M,{children:e.jsx(w,{children:"Create Schema"})}),i&&e.jsx(G,{variant:"destructive",children:e.jsx(R,{children:JSON.stringify((c=i.response)==null?void 0:c.data.message)})}),e.jsx(re,{onSubmit:l=>{n({databaseName:r,data:{name:l.name}})}}),e.jsxs(k,{children:[e.jsx(u,{disabled:o,variant:"outline",onClick:()=>s(!1),children:"Cancel"}),e.jsx(u,{disabled:o,form:"createSchemaDialogForm",type:"submit",children:"Create"})]})]})})}function oe({isLoading:a,schemas:s}){const r=S(),t=_(),n=[t.accessor("name",{header:"Name"}),t.accessor("created_at",{header:"Start Time",cell:i=>{const c=m(i.getValue()),f=m().diff(c,"minute")<24?m(c).fromNow():m(c).format("DD/MM/YYYY HH:mm");return e.jsx("span",{children:f})}})],o=i=>{r({to:"/databases/$databaseName/schemas/$schemaName/tables",params:{databaseName:i.database,schemaName:i.name}})};return e.jsx(U,{rounded:!0,columns:n,data:s,isLoading:a,onRowClick:o})}function ie(){const[a,s]=D.useState(!1),{databaseName:r}=C({from:"/databases/$databaseName/schemas/"}),{data:{items:t}={},isFetching:n}=Z(r);return e.jsxs(e.Fragment,{children:[e.jsxs(q,{direction:"horizontal",children:[e.jsx(d,{collapsible:!0,defaultSize:20,minSize:20,order:1,children:e.jsx(J,{})}),e.jsx(K,{withHandle:!0}),e.jsxs(d,{collapsible:!0,defaultSize:20,order:1,children:[e.jsx(L,{title:r,Icon:F,secondaryText:`${t==null?void 0:t.length} schemas found`,Action:e.jsx(u,{disabled:n,onClick:()=>s(!0),children:"Add Schema"})}),e.jsx(V,{isEmpty:!(t!=null&&t.length),Table:e.jsx(oe,{isLoading:n,schemas:t??[]}),emptyStateIcon:Y,emptyStateTitle:"No Schemas Found",emptyStateDescription:"No schemas have been created yet. Create a schema to get started."})]})]}),e.jsx(ne,{opened:a,onSetOpened:s,databaseName:r})]})}const je=ie;export{je as component};
