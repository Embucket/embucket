import{ao as A,ap as C,aq as I,ar as T,as as O,r as P,j as F}from"./index-Ct9KqqwV.js";import{g as Q,b as B}from"./tables-CkGhX4Fc.js";import{c as S,D as V}from"./data-table-DgQGtZgu.js";var _=class extends A{constructor(e,t){super(e,t)}bindMethods(){super.bindMethods(),this.fetchNextPage=this.fetchNextPage.bind(this),this.fetchPreviousPage=this.fetchPreviousPage.bind(this)}setOptions(e){super.setOptions({...e,behavior:C()})}getOptimisticResult(e){return e.behavior=C(),super.getOptimisticResult(e)}fetchNextPage(e){return this.fetch({...e,meta:{fetchMore:{direction:"forward"}}})}fetchPreviousPage(e){return this.fetch({...e,meta:{fetchMore:{direction:"backward"}}})}createResult(e,t){const{state:r}=e,s=super.createResult(e,t),{isFetching:c,isRefetching:a,isError:i,isRefetchError:n}=s,o=r.fetchMeta?.fetchMore?.direction,g=i&&o==="forward",u=c&&o==="forward",v=i&&o==="backward",w=c&&o==="backward";return{...s,fetchNextPage:this.fetchNextPage,fetchPreviousPage:this.fetchPreviousPage,hasNextPage:T(t,r.data),hasPreviousPage:I(t,r.data),isFetchNextPageError:g,isFetchingNextPage:u,isFetchPreviousPageError:v,isFetchingPreviousPage:w,isRefetchError:n&&!g&&!v,isRefetching:a&&!u&&!w}}};function j(e,t){return O(e,_)}const q=25,E=e=>Array.isArray(e.rows)?e.rows:[],M=e=>Array.isArray(e.items)?e.items:[];function X({databaseName:e,schemaName:t,tableName:r,pageSize:s=q,enabled:c=!0}){const{data:a,fetchNextPage:i,hasNextPage:n,isFetchingNextPage:o,isLoading:g,isFetching:u,error:v,refetch:w}=j({queryKey:Q(e,t,r,{limit:s}),queryFn:async({pageParam:l=0})=>B(e,t,r,{limit:s,offset:l}),initialPageParam:0,enabled:c,getNextPageParam:(l,m)=>{const d=M(l);if(!(d.length===0||E(d[0]).length<s))return m.reduce((h,x)=>{const p=M(x);return h+(p[0]?E(p[0]).length:0)},0)}}),b=P.useMemo(()=>{if(!a?.pages)return[];const l=new Map;return a.pages.forEach(m=>{M(m).forEach(d=>{const f=l.get(d.name),h=E(d);f?f.rows.push(...h):l.set(d.name,{name:d.name,rows:[...h]})})}),Array.from(l.values())},[a]),R=P.useCallback(()=>{n&&!o&&i()},[i,n,o]);return{data:b,isLoading:g,isFetching:u,isFetchingNextPage:o,hasNextPage:n,error:v,loadMore:R,refetch:w}}var D=new Map,y=new WeakMap,N=0,G=void 0;function H(e){return e?(y.has(e)||(N+=1,y.set(e,N.toString())),y.get(e)):"0"}function K(e){return Object.keys(e).sort().filter(t=>e[t]!==void 0).map(t=>`${t}_${t==="root"?H(e.root):e[t]}`).toString()}function L(e){const t=K(e);let r=D.get(t);if(!r){const s=new Map;let c;const a=new IntersectionObserver(i=>{i.forEach(n=>{var o;const g=n.isIntersecting&&c.some(u=>n.intersectionRatio>=u);e.trackVisibility&&typeof n.isVisible>"u"&&(n.isVisible=g),(o=s.get(n.target))==null||o.forEach(u=>{u(g,n)})})},e);c=a.thresholds||(Array.isArray(e.threshold)?e.threshold:[e.threshold||0]),r={id:t,observer:a,elements:s},D.set(t,r)}return r}function $(e,t,r={},s=G){if(typeof window.IntersectionObserver>"u"&&s!==void 0){const o=e.getBoundingClientRect();return t(s,{isIntersecting:s,target:e,intersectionRatio:typeof r.threshold=="number"?r.threshold:0,time:0,boundingClientRect:o,intersectionRect:o,rootBounds:o}),()=>{}}const{id:c,observer:a,elements:i}=L(r),n=i.get(e)||[];return i.has(e)||i.set(e,n),n.push(t),a.observe(e),function(){n.splice(n.indexOf(t),1),n.length===0&&(i.delete(e),a.unobserve(e)),i.size===0&&(a.disconnect(),D.delete(c))}}function Y({threshold:e,delay:t,trackVisibility:r,rootMargin:s,root:c,triggerOnce:a,skip:i,initialInView:n,fallbackInView:o,onChange:g}={}){var u;const[v,w]=P.useState(null),b=P.useRef(g),[R,l]=P.useState({inView:!!n,entry:void 0});b.current=g,P.useEffect(()=>{if(i||!v)return;let h;return h=$(v,(x,p)=>{l({inView:x,entry:p}),b.current&&b.current(x,p),p.isIntersecting&&a&&h&&(h(),h=void 0)},{root:c,rootMargin:s,threshold:e,trackVisibility:r,delay:t},o),()=>{h&&h()}},[Array.isArray(e)?e.toString():e,v,c,s,a,i,r,o,t]);const m=(u=R.entry)==null?void 0:u.target,d=P.useRef(void 0);!v&&m&&!a&&!i&&d.current!==m&&(d.current=m,l({inView:!!n,entry:void 0}));const f=[w,R.inView,R.entry];return f.ref=f[0],f.inView=f[1],f.entry=f[2],f}function U(e){const t=new Map;for(const r of e)t.has(r.name)||t.set(r.name,{name:r.name,rows:[]}),t.get(r.name).rows.push(...r.rows);return Array.from(t.values())}function W(e){const t=[];if(e.length>0){const r=Math.max(...e.map(s=>s.rows.length));for(let s=0;s<r;s+=1){const c={};for(const a of e)c[a.name]=a.rows[s]?.data??"";t.push(c)}}return t}function k({isLoading:e,columns:t}){const r=S(),s=U(t),c=s.map(i=>r.accessor(n=>n[i.name],{header:i.name,cell:n=>n.getValue(),meta:{headerClassName:"capitalize truncate",cellClassName:"truncate max-w-xl"}})),a=W(s);return F.jsx(V,{columns:c,data:a,isLoading:e})}export{k as D,X as a,Y as u};
