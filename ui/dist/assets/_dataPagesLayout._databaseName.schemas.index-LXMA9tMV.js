import{ak as x,am as j,al as d,j as e,d as S,B as m,F as b,e as C,r as h,m as F,D as q}from"./index-Ct9KqqwV.js";import{u as D}from"./use-debounce-DaRTt4xN.js";import{A as v,a as N}from"./alert-BMd_jCtt.js";import{D as K,a as P,b as O,c as T,i as Q,g as I}from"./dashboard-DqU8RIG6.js";import{g as R}from"./navigation-trees-DSZT8EBt.js";import{u as w,a as A,o as $,F as E,b as G,c as k,d as L,e as H,f as M,s as B}from"./form-D9y2bvZi.js";import{b as p,I as V,a as _}from"./input-C_MJiXMR.js";import{P as z}from"./page-empty-container-C-kS49aP.js";import{P as J}from"./page-header-9iDmaRsA.js";import{P as U}from"./page-scroll-area-DX8YZP6j.js";import{c as W,D as X}from"./data-table-DgQGtZgu.js";import{f as Y}from"./formatTime-DTXdKjzH.js";import{R as Z}from"./refresh-button-CqT5Ge7j.js";import{S as ee}from"./search-r_qVZtJ3.js";import{F as ae}from"./folder-tree-C1iNkWyL.js";import"./scroll-area-DS2laZp3.js";const se=(a,s,t,r)=>d({url:`/ui/databases/${a}/schemas`,method:"GET",params:s,signal:r},t),y=(a,s)=>[`/ui/databases/${a}/schemas`,...s?[s]:[]],te=(a,s,t)=>{const{query:r,request:c}={};return{queryKey:r?.queryKey??y(a,s),queryFn:({signal:i})=>se(a,s,c,i),enabled:!!a,...r}};function re(a,s,t,r){const c=te(a,s),n=x(c);return n.queryKey=c.queryKey,n}const ne=(a,s,t,r)=>d({url:`/ui/databases/${a}/schemas`,method:"POST",headers:{"Content-Type":"application/json"},data:s,signal:r},t),oe=a=>{const s=["createSchema"],{mutation:t,request:r}=a?a.mutation&&"mutationKey"in a.mutation&&a.mutation.mutationKey?a:{...a,mutation:{...a.mutation,mutationKey:s}}:{mutation:{mutationKey:s},request:void 0};return{mutationFn:n=>{const{databaseName:o,data:i}=n??{};return ne(o,i,r)},...t}},ce=(a,s)=>{const t=oe(a);return j(t)},ie=$({name:B()}),me=({onSubmit:a})=>{const s=w({resolver:A(ie),defaultValues:{name:""}});return e.jsx(E,{...s,children:e.jsx("form",{id:"createSchemaDialogForm",onSubmit:s.handleSubmit(a),className:"flex flex-col gap-4",children:e.jsx(G,{control:s.control,name:"name",render:({field:t})=>e.jsxs(k,{children:[e.jsx(L,{children:"Schema Name"}),e.jsx(H,{children:e.jsx(p,{...t,type:"name",required:!0})}),e.jsx(M,{})]})})})})};function ue({opened:a,onSetOpened:s,databaseName:t}){const r=S(),{mutate:c,isPending:n,error:o}=ce({mutation:{onSuccess:async()=>{await Promise.all([r.invalidateQueries({queryKey:R()}),r.invalidateQueries({queryKey:I()}),r.invalidateQueries({queryKey:y(t)})]),s(!1),b.success("Schema was successfully created")}}});return e.jsx(K,{open:a,onOpenChange:s,children:e.jsxs(P,{children:[e.jsx(O,{children:e.jsx(T,{children:"Create Schema"})}),o&&e.jsx(v,{variant:"destructive",children:e.jsx(N,{children:JSON.stringify(o.response?.data.message)})}),e.jsx(me,{onSubmit:i=>{c({databaseName:t,data:{name:i.name}})}}),e.jsxs(Q,{children:[e.jsx(m,{disabled:n,variant:"outline",onClick:()=>s(!1),children:"Cancel"}),e.jsx(m,{disabled:n,form:"createSchemaDialogForm",type:"submit",children:"Create"})]})]})})}function le({isLoading:a,schemas:s}){const t=C(),r=W(),c=[r.accessor("name",{header:"Name"}),r.accessor("created_at",{header:"Created",cell:o=>e.jsx("span",{children:Y(o.getValue())})})],n=o=>{t({to:"/databases/$databaseName/schemas/$schemaName/tables",params:{databaseName:o.database,schemaName:o.name}})};return e.jsx(X,{rounded:!0,columns:c,data:s,isLoading:a,onRowClick:n})}function he({search:a,onSetSearch:s,schemas:t,isFetchingSchemas:r,onRefetchSchemas:c}){return e.jsxs("div",{className:"flex items-center justify-between gap-4 p-4",children:[e.jsx("p",{className:"text-muted-foreground text-sm text-nowrap",children:t.length?`${t.length} schemas found`:""}),e.jsxs("div",{className:"justify flex items-center justify-between gap-2",children:[e.jsxs(V,{className:"w-full",children:[e.jsx(_,{children:e.jsx(ee,{})}),e.jsx(p,{value:a,onChange:n=>s(n.target.value),placeholder:"Search"})]}),e.jsx(Z,{isDisabled:r,onRefresh:c})]})]})}function de(){const[a,s]=h.useState(!1),[t,r]=h.useState(""),c=D(t,300),{databaseName:n}=F({from:"/databases/_dataPagesLayout/$databaseName/schemas/"}),{data:{items:o}={},isFetching:i,isLoading:u,refetch:f}=re(n,{search:c}),l=!o?.length,g=l&&t.length>0;return e.jsxs(e.Fragment,{children:[e.jsx(J,{title:n,Icon:q,Action:e.jsx(m,{size:"sm",disabled:i,onClick:()=>s(!0),children:"Add Schema"})}),e.jsx(he,{search:t,onSetSearch:r,schemas:o??[],isFetchingSchemas:i,onRefetchSchemas:f}),l&&!u?e.jsx(z,{Icon:ae,variant:"toolbar",title:"No Schemas Found",description:g?"No schemas match your search.":"No schemas have been found for this database."}):e.jsx(U,{children:e.jsx(le,{isLoading:u,schemas:o??[]})}),e.jsx(ue,{opened:a,onSetOpened:s,databaseName:n})]})}const Oe=de;export{Oe as component};
