import{j as e,r as h,e as D,m as T,B as S}from"./index-Ct9KqqwV.js";import{u as y,a as C,D as L}from"./data-preview-table-C6r38azm.js";import{T as E,a as I,b as x,c as R}from"./tabs-Cg01znNs.js";import{T as $}from"./table-data-upload-dialog-CI5z27sW.js";import{P as F}from"./page-empty-container-C-kS49aP.js";import{P as M}from"./page-header-9iDmaRsA.js";import{P as B}from"./page-scroll-area-DX8YZP6j.js";import{I as O,a as V,b as k}from"./input-C_MJiXMR.js";import{R as z}from"./refresh-button-CqT5Ge7j.js";import{S as A}from"./search-r_qVZtJ3.js";import{T as w}from"./table-DGhiBpVf.js";import"./tables-CkGhX4Fc.js";import"./data-table-DgQGtZgu.js";import"./scroll-area-DS2laZp3.js";import"./alert-BMd_jCtt.js";import"./dashboard-DqU8RIG6.js";import"./navigation-trees-DSZT8EBt.js";import"./select-Yobvwtbb.js";import"./index-Da2Z8ThW.js";function _({previewData:a,isFetchingPreviewData:t,search:i,onSearch:n,onRefetchPreviewData:m}){return e.jsxs("div",{className:"flex items-center justify-between gap-4 p-4",children:[e.jsx("p",{className:"text-muted-foreground text-sm text-nowrap",children:a[0]?.rows.length?`${a[0]?.rows.length} rows found`:""}),e.jsxs("div",{className:"justify flex items-center justify-between gap-2",children:[e.jsxs(O,{className:"w-full",children:[e.jsx(V,{children:e.jsx(A,{})}),e.jsx(k,{value:i,onChange:s=>n(s.target.value),placeholder:"Search data"})]}),e.jsx(z,{isDisabled:t,onRefresh:m})]})]})}function G({previewData:a,search:t}){const i=h.useMemo(()=>{if(!a?.length||!t)return a??[];const s=t.toLowerCase();if(a.some(o=>o.name.toLowerCase().includes(s)))return a;const r=new Set;return a.forEach(o=>{o.rows.forEach((d,l)=>{d.data.toLowerCase().includes(s)&&r.add(l)})}),a.map(o=>({...o,rows:o.rows.filter((d,l)=>r.has(l))}))},[a,t]),n=!i.length||i.every(s=>s.rows.length===0),m=t.length>0&&n;return{searchedPreviewData:i,isEmpty:n,isEmptyDueToSearch:m}}function H(){const a=D(),[t,i]=h.useState(""),[n,m]=h.useState(!1),{databaseName:s,schemaName:c,tableName:r}=T({from:"/databases/_dataPagesLayout/$databaseName/schemas/$schemaName/tables/$tableName/data-preview/"}),{ref:o,inView:d}=y({threshold:.1}),{data:l,isLoading:u,isFetching:p,isFetchingNextPage:b,hasNextPage:f,loadMore:j,refetch:v}=C({databaseName:s,schemaName:c,tableName:r});d&&f&&!b&&j();const{searchedPreviewData:g,isEmpty:P,isEmptyDueToSearch:N}=G({previewData:l,search:t});return e.jsxs(e.Fragment,{children:[e.jsx(M,{title:r,Icon:w,Action:e.jsx(S,{size:"sm",onClick:()=>m(!0),disabled:p,children:"Load Data"})}),e.jsxs(E,{defaultValue:"data-preview",variant:"underline",className:"size-full",children:[e.jsxs(I,{className:"px-4",children:[e.jsx(x,{onClick:()=>a({to:"/databases/$databaseName/schemas/$schemaName/tables/$tableName/columns",params:{databaseName:s,schemaName:c,tableName:r}}),value:"columns",children:"Columns"}),e.jsx(x,{value:"data-preview",children:"Data Preview"})]}),e.jsxs(R,{value:"data-preview",className:"m-0",children:[e.jsx(_,{previewData:g,isFetchingPreviewData:p,search:t,onSearch:i,onRefetchPreviewData:v}),P&&!u?e.jsx(F,{variant:"tabs",Icon:w,title:"No Data Found",description:N?"No data matches your search.":"No data has been loaded for this table yet."}):e.jsxs(B,{tabs:!0,children:[e.jsx(L,{columns:g,isLoading:u}),f&&e.jsx("div",{ref:o})]})]})]}),s&&c&&r&&e.jsx($,{opened:n,onSetOpened:m,databaseName:s,schemaName:c,tableName:r})]})}const le=H;export{le as component};
